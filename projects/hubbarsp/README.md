## Project Proposal

My project proposal is to use the Template Scripting Testing Language (TSTL) to
define a test harness for the `sqlparse` Python module. The module provides a
parser for SQL statements. The parser takes a string for a SQL statement and
returns an object for the parse tree of the SQL statement. The module also
provides classes and methods for analyzing parse trees of SQL statements.

### Test Goal

The parser provided by the `sqlparse` module will be tested for correctness on
the simplified version of SQL, which we will call our object language. Note that
our object language is defined by the grammars below. The parser is considered
correct if the returned object represents the parse tree of the input statement,
for any statement in our object language. The XML example will be used to guide
the initial design.

### Install Module

The `sqlparse` module is compatible with both Python 2.7 and Python 3. The
project page and repository for the module is located [here][sqlparse]. There
are several ways to install the module.

One way to install the module is by cloning the [repository][sqlparse] and then
running the setup script:

```bash
$ python setup.py install
```

Another way to install the module is by using pip:

```bash
$ pip install sqlparse
```

Note that the version of the module installed using pip might be older and
incompatible with the version targeted by the test harness.

### Test Module

A simple test harness for the `sqlparse` module is defined by `mysqlparse.tstl`.
The test harness is generated using TSTL:

```bash
$ rm sut.*
$ tstl --nocover mysqlparse.tstl
```

These commands will generate the test harness (without coverage) named `sut.py`
and `sut.pyc`.

For the next two commands, the path to the random tester and model checker
should be replaced. An example run of the random tester:

```bash
$ python ../../../tstl/generators/randomtester.py --nocover --maxtest=100 --depth=50
```

An example run of the breadth first search (BFS) model checker:

```bash
$ python ../../../tstl/generators/bfsmodelchecker.py --nocover --forget=0.5 --depth=50
```

Note that model checker has not actually run on the test harness.

## Bug Report

No bugs have been found in the SUT.

Several failing tests have been generated by the random tester. However, these
failing tests were related to incorrect actions in the test harness and not bugs
in the SUT. For example, an action that allowed a `<sel-clause>` terminated by a
semicolon to be used in a `<tab-clause>` would lead to a failing test but would
not lead to a legal statement, see grammars below.

**TODO:** finish bug report.

### Grammar

The structured query language (SQL) consists of two sublanguages: the data
definition language (DDL) and the data manipulation language (DML). Our object
language will consist of simplified DDL and DML statements. Concrete syntax
common to both DDL and DML statements is given by the following grammar:

```
<name> ::= (any name not a keyword)
<qual-name> ::= <name> | <name> . <name>
<qual-names> ::= <qual-name> [, <qual-name>]
```

DDL statements in our object language are simplified `CREATE` statements.
Concrete syntax specific to DDL statements is given by the following grammar:

```
<type> ::= INT | FLOAT | VARCHAR ( <len> )
<len> ::= (any non-negative integer)

<const> ::= NOT NULL | UNIQUE | PRIMARY KEY

<cols> ::= <name> [<type>] [<const>] [, <cols>]

<ddl> ::= CREATE TABLE <qual-name> ( <cols> ) ;
```

DML statements in our object language are simplified `SELECT` statements.
Concrete syntax specific to DML statements is given by the following grammar:

```
<num> ::= (any number)
<str> ::= (any quoted string)
<bool> ::= TRUE | FALSE | UNKNOWN

<row-op> ::= < | <= | > | >= | = | <>
<pred-op> ::= AND | OR

<row> ::= <num> | <str> | <qual-name>

<pred> ::= <row> [IS [NOT] NULL]
         | <row> <row-op> <row>
         | [NOT] <pred> [IS [NOT] <bool>]
         | <pred> <pred-op> <pred>
         | ( <pred> )

<cols> ::= * | <qual-names>

<tab> ::= <qual-names> | ( <sel> )

<sel> ::= SELECT <cols> FROM <tab> [WHERE <pred>]

<dml> ::= <sel> ;
```

[sqlparse]: https://github.com/andialbrecht/sqlparse
